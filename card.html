<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>comoorï½œæ—¥å¸¸æµ®ç¾ Daily Emergenceï½œNFC åŠç‰Œæ•…äº‹ç³»çµ±</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="comoorï½œæ—¥å¸¸æµ®ç¾ï¼ˆDaily Emergenceï¼‰æ˜¯ä¸€å¥—ç”±å¯¦é«”åŠç‰Œ NFC è§¸ç™¼çš„æ•…äº‹ç³»çµ±ã€‚æ„Ÿæ‡‰åŠç‰Œå³å¯éš¨æ©Ÿé‡è¦‹æ—¥å¸¸æ•…äº‹ã€é¡§å®¢åˆ†äº«èˆ‡é©šå–œå…§å®¹ï¼Œè®“æƒ…æ„Ÿèˆ‡è¨˜æ†¶åœ¨ç”Ÿæ´»ä¸­è‡ªç„¶æµ®ç¾ã€‚">
    <meta name="keywords" content="comoor, æ—¥å¸¸æµ®ç¾, Daily Emergence, NFC åŠç‰Œ, æ•…äº‹ç³»çµ±, å“ç‰Œæ•…äº‹, å®¢è£½åŒ–åŠç‰Œ, NFC æ„Ÿæ‡‰, äº’å‹•æ•…äº‹, ç”Ÿæ´»æ•…äº‹, å“ç‰Œé«”é©—, å¯¦é«”äº’å‹•, æŠ½å¡æ´»å‹•, åŸå¸‚æ‰“å¡, è¯åæ•…äº‹">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://chicmoor.github.io/comoor/card.html">
    <meta property="og:title" content="comoorï½œæ—¥å¸¸æµ®ç¾ Daily Emergenceï½œNFC åŠç‰Œæ•…äº‹ç³»çµ±">
    <meta property="og:description" content="comoorï½œæ—¥å¸¸æµ®ç¾ï¼ˆDaily Emergenceï¼‰æ˜¯ä¸€å¥—ç”±å¯¦é«”åŠç‰Œ NFC è§¸ç™¼çš„æ•…äº‹ç³»çµ±ã€‚æ„Ÿæ‡‰åŠç‰Œå³å¯éš¨æ©Ÿé‡è¦‹æ—¥å¸¸æ•…äº‹ã€é¡§å®¢åˆ†äº«èˆ‡é©šå–œå…§å®¹ï¼Œè®“æƒ…æ„Ÿèˆ‡è¨˜æ†¶åœ¨ç”Ÿæ´»ä¸­è‡ªç„¶æµ®ç¾ã€‚">
    <meta property="og:image" content="https://chicmoor.github.io/comoor/assets/images/comoor.jpg">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="comoorï½œæ—¥å¸¸æµ®ç¾ Daily Emergenceï½œNFC åŠç‰Œæ•…äº‹ç³»çµ±">
    <meta name="twitter:description" content="comoorï½œæ—¥å¸¸æµ®ç¾ï¼ˆDaily Emergenceï¼‰æ˜¯ä¸€å¥—ç”±å¯¦é«”åŠç‰Œ NFC è§¸ç™¼çš„æ•…äº‹ç³»çµ±ã€‚æ„Ÿæ‡‰åŠç‰Œå³å¯éš¨æ©Ÿé‡è¦‹æ—¥å¸¸æ•…äº‹ã€é¡§å®¢åˆ†äº«èˆ‡é©šå–œå…§å®¹ï¼Œè®“æƒ…æ„Ÿèˆ‡è¨˜æ†¶åœ¨ç”Ÿæ´»ä¸­è‡ªç„¶æµ®ç¾ã€‚">
    <meta name="twitter:image" content="https://chicmoor.github.io/comoor/assets/images/comoor.jpg">

    <!-- Access Control - Must load first -->
    <link rel="stylesheet" href="css/access-control.css">
    <script src="js/access-control.js"></script>

    <!-- Cookie Consent -->
    <link rel="stylesheet" href="css/cookie-consent.css">
    <script src="js/cookie-consent.js"></script>

    <!-- Google Tag Manager - Loaded conditionally after consent -->
    <script>
        // Initialize dataLayer
        window.dataLayer = window.dataLayer || [];

        // Load analytics configuration from config/analytics.json
        async function loadAnalyticsConfig() {
            try {
                const response = await fetch('config/analytics.json');
                if (response.ok) {
                    const config = await response.json();
                    console.log('âš™ï¸ Analytics config loaded:', config);
                    return config;
                } else {
                    console.warn('âš ï¸ Failed to load analytics config, using fallback');
                }
            } catch (error) {
                console.warn('âš ï¸ Failed to load analytics config:', error);
            }

            // Fallback config
            return {
                gtm: {
                    containerId: 'GTM-NQB6RCSF',
                    enabled: true
                }
            };
        }

        // Function to load GTM
        function loadGTM(gtmId) {
            (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer',gtmId);
            console.log('âœ… GTM loaded:', gtmId);

            // Configure cookie domain after GTM loads
            setTimeout(configureGA4CookieDomain, 1000); // Wait 1s for GTM to initialize
        }

        // Configure GA4 cookie domain
        function configureGA4CookieDomain() {
            console.log('ğŸ”§ Configuring GA4 cookie domain...');

            // Method 1: Using dataLayer (recommended for GTM)
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': 'cookie_config',
                'cookie_domain': 'auto',
                'cookie_flags': 'SameSite=None;Secure'
            });

            // Method 2: Direct gtag configuration (fallback)
            // Wait for gtag to be available (loaded by GTM's GA4 tag)
            const waitForGtag = setInterval(function() {
                if (typeof window.gtag === 'function') {
                    clearInterval(waitForGtag);
                    window.gtag('config', 'G-3NKQDRH55Z', {
                        'cookie_domain': 'auto',
                        'cookie_flags': 'SameSite=None;Secure'
                    });
                    console.log('âœ… GA4 cookie domain configured via gtag');
                }
            }, 100);

            // Clear interval after 5 seconds to prevent infinite checking
            setTimeout(function() {
                clearInterval(waitForGtag);
            }, 5000);
        }

        // Initialize GTM with config
        async function initializeGTM() {
            const config = await loadAnalyticsConfig();

            if (!config.gtm.enabled) {
                console.log('ğŸ“Š GTM disabled in config');
                return;
            }

            window.GTM_ID = config.gtm.containerId;
            window.analyticsConfig = config;

            // Load GTM if consent already granted
            if (window.cookieConsent && window.cookieConsent.consentStatus === 'accepted') {
                loadGTM(window.GTM_ID);
            }
        }

        // Load GTM when consent is granted
        if (window.cookieConsent) {
            window.cookieConsent.onAccept(async function() {
                if (!window.GTM_ID) {
                    await initializeGTM();
                } else {
                    loadGTM(window.GTM_ID);
                }
            });
        }

        // Initialize on page load
        initializeGTM();
    </script>

    <!-- DataLayer Helper -->
    <script src="js/gtm-datalayer.js"></script>

    <!-- Page Styles -->
    <link rel="stylesheet" href="css/card.css">
    <link rel="stylesheet" href="css/text-overlay.css">
    <link rel="stylesheet" href="css/rate-limit-ui.css">
    <link rel="stylesheet" href="css/contact-form.css">
    <link rel="stylesheet" href="css/comment-panel.css">
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NQB6RCSF"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div class="container">
        <div class="image-container">
            <img id="cardImage" src="" alt="Card Image" class="card-image">
            <div id="textOverlay" class="text-overlay">
                <h3 class="text-overlay-title"></h3>
                <p class="text-overlay-description"></p>
            </div>
        </div>
    </div>

    <!-- Heart Like Button (fixed to window corner) -->
    <div class="heart-icon" id="heartIcon" role="button" aria-label="å–œæ­¡é€™å€‹æ•…äº‹" title="å–œæ­¡é€™å€‹æ•…äº‹">ğŸ¤</div>

    <!-- Contact Form Modal -->
    <div id="contactFormOverlay" class="contact-form-overlay">
        <div class="contact-form-container">
            <div class="contact-form-header">
                <div class="contact-form-title">ğŸ‰ æ­å–œä¸­çï¼</div>
                <div class="contact-form-subtitle">è«‹å¡«å¯«è¯ç¹«è³‡è¨Šï¼Œæˆ‘å€‘æœƒç›¡å¿«èˆ‡æ‚¨è¯ç¹«</div>
            </div>

            <form id="contactForm" class="contact-form">
                <div class="form-group">
                    <label for="prizeTitle" class="form-label">çå“åç¨±</label>
                    <input type="text" id="prizeTitle" name="prizeTitle" class="form-input" placeholder="è¼‰å…¥ä¸­..." readonly>
                </div>

                <div class="form-group">
                    <label for="account" class="form-label">å®˜ç¶²å¸³è™Ÿ *</label>
                    <input type="text" id="account" name="account" class="form-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„å®˜ç¶²å¸³è™Ÿ" required>
                    <div class="error-message" id="accountError">è«‹è¼¸å…¥æ‚¨çš„å®˜ç¶²å¸³è™Ÿ</div>
                </div>

                <div class="form-group">
                    <label for="phone" class="form-label">é€£çµ¡é›»è©± *</label>
                    <input type="tel" id="phone" name="phone" class="form-input" placeholder="è«‹è¼¸å…¥é€£çµ¡é›»è©±" required>
                    <div class="error-message" id="phoneError">è«‹è¼¸å…¥æœ‰æ•ˆçš„é€£çµ¡é›»è©±</div>
                </div>

                <div class="form-group">
                    <label for="recipientName" class="form-label">æ”¶ä»¶å§“å *</label>
                    <input type="text" id="recipientName" name="recipientName" class="form-input" placeholder="è«‹è¼¸å…¥æ”¶ä»¶äººå§“å" required>
                    <div class="error-message" id="recipientNameError">è«‹è¼¸å…¥æ”¶ä»¶äººå§“å</div>
                </div>

                <div class="form-group">
                    <label for="address" class="form-label">æ”¶ä»¶åœ°å€ *</label>
                    <textarea id="address" name="address" class="form-textarea" placeholder="è«‹è¼¸å…¥å®Œæ•´çš„æ”¶ä»¶åœ°å€..." required></textarea>
                    <div class="error-message" id="addressError">è«‹è¼¸å…¥æ”¶ä»¶åœ°å€</div>
                </div>

                <div class="form-group">
                    <label for="message" class="form-label">æƒ³å° Comoor èªªçš„è©± *</label>
                    <textarea id="message" name="message" class="form-textarea" placeholder="åˆ†äº«æ‚¨çš„æƒ³æ³•æˆ–å»ºè­°..." required></textarea>
                    <div class="error-message" id="messageError">è«‹è¼¸å…¥æ‚¨æƒ³èªªçš„è©±</div>
                </div>

                <div class="form-buttons">
                    <button type="button" class="form-button form-button-secondary" id="cancelButton">å–æ¶ˆ</button>
                    <button type="submit" class="form-button form-button-primary" id="submitButton">
                        <span id="submitText">é€å‡º</span>
                        <div class="form-loading" id="submitLoading">
                            <div class="form-loading-spinner"></div>
                            <span>é€å‡ºä¸­...</span>
                        </div>
                    </button>
                </div>

                <div class="form-success" id="formSuccess">
                    âœ… è³‡æ–™å·²æˆåŠŸé€å‡ºï¼æˆ‘å€‘æœƒç›¡å¿«èˆ‡æ‚¨è¯ç¹«ï¼Œè¬è¬ï¼
                </div>

                <div class="form-error" id="formError">
                    âŒ é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–æª¢æŸ¥ç¶²è·¯é€£ç·š
                </div>
            </form>
        </div>
    </div>

    <!-- Comment Icon (fixed to window corner) -->
    <div class="comment-icon" id="commentIcon" role="button" aria-label="ç•™è¨€åˆ†äº«æ•…äº‹æ„Ÿæƒ³" title="ç•™è¨€åˆ†äº«æ•…äº‹æ„Ÿæƒ³">ğŸ’¬</div>

    <!-- Comment Panel -->
    <div id="commentPanelOverlay" class="comment-panel-overlay">
        <div class="comment-panel-container">
            <div class="comment-panel-header">
                <div class="comment-panel-title">ğŸ’¬ åœ¨æ­¤ï¼Œç•™ä¸‹æ‚¨å¿ƒä¸­çš„é¤˜éŸ»</div>
                <button class="comment-panel-close" id="commentPanelClose" aria-label="é—œé–‰">âœ•</button>
            </div>

            <form id="commentForm" class="comment-form">
                <div class="form-group">
                    <label for="commentText" class="form-label">æ‚¨çš„ç•™è¨€</label>
                    <textarea
                        id="commentText"
                        name="commentText"
                        class="form-textarea"
                        placeholder="å¯«ä¸‹æ­¤åˆ»è…¦æµ·ä¸­æµ®ç¾çš„éš»å­—ç‰‡èª..."
                        maxlength="500"
                        required
                    ></textarea>
                    <div class="character-counter">
                        <span id="charCount">0</span> / 500
                    </div>
                    <div class="error-message" id="commentTextError">è«‹è¼¸å…¥è‡³å°‘ 5 å€‹å­—çš„ç•™è¨€</div>
                </div>

                <div class="form-buttons">
                    <button type="button" class="form-button form-button-secondary" id="commentCancelButton">å–æ¶ˆ</button>
                    <button type="submit" class="form-button form-button-primary" id="commentSubmitButton">
                        <span id="commentSubmitText">é€å‡º</span>
                        <div class="form-loading" id="commentSubmitLoading">
                            <div class="form-loading-spinner"></div>
                            <span>é€å‡ºä¸­...</span>
                        </div>
                    </button>
                </div>

                <div class="form-success" id="commentSuccess">
                    è®“å¿ƒæ„åœ¨æ­¤å®‰æ”¾ï¼Œæˆç‚ºæ•…äº‹æº«æŸ”çš„è¨»è§£ã€‚
                </div>

                <div class="form-error" id="commentFormError">
                    âŒ å¿ƒæ„æ²’æœ‰æˆåŠŸå‚³éï¼Œè«‹è®“æˆ‘å€‘çŸ¥é“ï¼Œè¬è¬ä½ 
                </div>
            </form>
        </div>
    </div>

    <script src="js/contact-collection.js"></script>
    <script src="js/comment-collection.js"></script>
    <script src="js/card.js"></script>
</body>
</html>
